function Bezier(mX1,mY1,mX2,mY2){function A(aA1,aA2){return 1-3*aA2+3*aA1}function B(aA1,aA2){return 3*aA2-6*aA1}function C(aA1){return 3*aA1}function CalcBezier(aT,aA1,aA2){return((A(aA1,aA2)*aT+B(aA1,aA2))*aT+C(aA1))*aT}function GetSlope(aT,aA1,aA2){return 3*A(aA1,aA2)*aT*aT+2*B(aA1,aA2)*aT+C(aA1)}function GetTForX(aX){for(var aGuessT=aX,i=0;i<4;++i){var currentSlope=GetSlope(aGuessT,mX1,mX2);if(0==currentSlope)return aGuessT;aGuessT-=(CalcBezier(aGuessT,mX1,mX2)-aX)/currentSlope}return aGuessT}this.get=function(aX){return mX1==mY1&&mX2==mY2?aX:CalcBezier(GetTForX(aX),mY1,mY2)}}angular.module("agenda",["angular-timeline"]).controller("agendaCtrl",["$rootScope","$scope","$state","db","$timeout","$stateParams","$sce",function($rootScope,$scope,$state,db,$timeout,$stateParams,$sce){$scope.items=pageOptions.slice(1),$scope.$parent.header.hide=!1,$scope.trustAsHtml=function(string){return $sce.trustAsHtml(string)},$rootScope.header.agenda2=!0,$rootScope.vars.personal_team&&"agenda2"==$rootScope.vars.personal_team&&($rootScope.agenda2="yes");var loadAgenda=function(ref){db.get(ref).then(function(agenda){$scope.loading=!1,db.get("speakers",!$rootScope.vars.dev).then(function(data){$scope.speakers=data.values}),$timeout(function(){var date=new Date;$scope.today=$stateParams.tab?$stateParams.tab:agenda.headers.date.options.indexOf([("0"+date.getDate()).slice(-2),("0"+(date.getMonth()+1)).slice(-2),date.getFullYear()].join(".")),-1===$scope.today&&($scope.today=0),$stateParams.tab&&($scope.today=$stateParams.tab),document.querySelectorAll(".md-tab")[+$scope.today].click()},200);var _data=[],obj={},r=new RegExp('"+',"g");for(var i in agenda.values)obj={},obj=agenda.values[i],obj.guid=i,obj.hasOwnProperty("order")?obj.order=+obj.order:obj.order=1e4,obj.hasOwnProperty("description")&&(obj.description=obj.description.replace(r,"'")),_data.push(obj);$scope.headers=agenda.headers,$scope.events=_data,$stateParams.id&&$stateParams.event&&$timeout(function(){$(".md-active").animate({scrollTop:$("#user-"+$stateParams.id+"_"+$stateParams.event).offset().top-113},500)},1e3)},function(){})};$scope.loading=!0,loadAgenda("agenda");var isAgenda2=!1;$rootScope.showAgenda2=function(){$scope.loading=!0,$rootScope.header.agenda2=!1,$rootScope.header.title="Доп. программа",isAgenda2=!0,loadAgenda("agenda2")},$scope.$parent.header.back=function(){isAgenda2?(isAgenda2=!1,$scope.loading=!0,loadAgenda("agenda"),$rootScope.header.title="Программа",$rootScope.header.agenda2=!0):location.hash="#/main"},$scope.swipe=function(ev,turn){var _tabs=document.querySelectorAll("md-tab-item");"right"===turn?$scope.today<_tabs.length-1&&($scope.today+=1):$scope.today>0&&($scope.today-=1),$timeout(function(){_tabs[$scope.today].click()})},$scope.currentTab=function(tab){$scope.today=tab},$scope.openSpeaker=function(id,f_eventguid){$state.go("speakers",{id:id,tab:$scope.today})}}]),angular.module("dinner",[]).controller("dinnerCtrl",["$rootScope","$scope","$state","$timeout","db",function($rootScope,$scope,$state,$timeout,db){$rootScope.header.back=function(){$scope.section?($rootScope.header.simpleSearch=!1,$rootScope.search&&($rootScope.search=""),$scope.section=!1,$rootScope.header.title="Гала-ужин"):(localStorage.animate=0,location.hash="#/main")},$scope.openSection=function(section,title){$timeout(function(){$scope.section=section,$rootScope.header.title=title,"gala_shema"==section&&($scope.opened_table=[],$rootScope.header.simpleSearch=!0,$rootScope.search&&($rootScope.search="")),db.get(section).then(function(data){$scope.loading=!0;var items=[];for(var v in data.values){var item={};item=data.values[v],item.order=data.values[v].order?+data.values[v].order:1e3,items.push(item)}$scope.headers=data.headers,$scope.items=items,$scope.loading=!1})},500)},$scope.customFilter=function(ftable){return function(item){return $scope.headers.table.options[item.table]==ftable}},$scope.toggleVisible=function(find){$scope.opened_table.indexOf(find)>-1?$scope.opened_table.splice($scope.opened_table.indexOf(find),1):$scope.opened_table.push(find)},$scope.opened_table=[]}]).filter("search",function(){return function(data,text,people){text=text||"",text=text.toLowerCase();var out=[];if(text.length<3)return data;for(var i=0;i<people.length;i++){(people[i].hasOwnProperty("fio")?people[i].fio.toLowerCase():"").indexOf(text)>-1&&people[i].hasOwnProperty("table")&&out.indexOf(-1==data[people[i].table])&&out.push(data[people[i].table])}return out}}),angular.module("info",[]).controller("infoCtrl",["$rootScope","$scope","$state","$timeout","db","$http","$stateParams","$mdDialog",function($rootScope,$scope,$state,$timeout,db,$http,$stateParams,$mdDialog){function getLetter(icon){return"01d"==icon||"01n"==icon?"B":"02d"==icon||"02n"==icon?"H":"03d"==icon||"03n"==icon?"H":"04d"==icon||"04n"==icon?"Y":"09d"==icon||"09n"==icon?"R":"10d"==icon||"10n"==icon?"Q":"11d"==icon||"11n"==icon?"P":"13d"==icon||"13n"==icon?"W":"50d"==icon||"50n"==icon?"M":"0S"}$scope.curSector=-1,$rootScope.header.back=function(){$scope.curSector=-1,$scope.section?($rootScope.header.simpleSearch=!1,"hotel_photos"!=$scope.section&&"hotel_halls"!=$scope.section?$scope.currentGuest?$scope.currentGuest=!1:($scope.section=!1,$rootScope.header.title="Useful Information"):($scope.section="hotel",$scope.openSection("hotel","Marriott Minsk"))):(localStorage.animate=0,location.hash="#/main")},$scope.showGuest=function(guest){$scope.currentGuest=guest},$scope.sendFreetime=function(obj){var data=obj;db.add("reetime_list",data),$mdDialog.show($mdDialog.alert().title("Данные отправлены").ok("Ок"))},$scope.openSection=function(section,title){$scope.loading=!0,$timeout(function(){$scope.section=section,$rootScope.header.title=title,"business_scheme"==section&&($scope.opened_table=[],$rootScope.header.simpleSearch=!0,$rootScope.search&&($rootScope.search="")),db.get(section).then(function(data){$scope.loading=!0;var items=[];for(var v in data.values){var item={};item=data.values[v],item.seat&&(item.seat=+item.seat),item.id=v,item.order=data.values[v].order?+data.values[v].order:1e3,items.push(item)}if($scope.items=items,$scope.headers=data.headers,$scope.loading=!1,"guests"==$stateParams.section)for(var i=0;i<$scope.items.length;i++)$scope.items[i].lname==$stateParams.lname&&$scope.showGuest($scope.items[i])},function(error){$scope.loading=!1})},500)},$scope.customFilter=function(ftable){return function(item){return $scope.headers.table.options[item.table]==ftable}},$scope.toggleVisible=function(find){$scope.opened_table.indexOf(find)>-1?$scope.opened_table.splice($scope.opened_table.indexOf(find),1):$scope.opened_table.push(find)},$scope.opened_table=[],$stateParams.section&&("business_scheme"==$stateParams.section?$scope.openSection($stateParams.section,"Seating chart"):"guests"!=$stateParams.section&&"main"!=$stateParams.section?$scope.openSection($stateParams.section,"Organizers"):"main"!=$stateParams.section&&$scope.openSection($stateParams.section,"Guests of the Conference")),$scope.APPID="4ccea7fb89b8c08e7e7ccb3e44a1c0ee",$scope.openOrg=function(f_id){$state.go("questions_to_orgs",{id:f_id})},$scope.locationSuccess=function(lat,lon){$http({method:"GET",headers:{"Content-Type":"application/x-www-form-urlencoded;charset=utf-8;"},url:"http://api.openweathermap.org/data/2.5/forecast",params:{lat:lat,lon:lon,lang:"en",appid:$scope.APPID,units:"metric",cnt:38},responseType:"json",cache:!1}).then(function(response){var d=response.data;if(d){var data=d.list[0],description=data.weather[0],icon=description.icon,temp=data.main.temp,info=description.description,wind=data.wind.speed,iconName=getLetter(icon);$scope.icon="../img/weather/"+iconName+".svg",$scope.temp=Math.round(temp)+"°C",$scope.info=info,$scope.wind=wind,localStorage.icon=$scope.icon,localStorage.temp=$scope.temp,localStorage.info=$scope.info,localStorage.wind=$scope.wind}},function(response){$scope.icon=localStorage.icon,$scope.temp=localStorage.temp,$scope.info=localStorage.info,$scope.wind=localStorage.wind})},$rootScope.vars.dev&&$scope.locationSuccess(48.2,16.4),$scope.locationSuccess(48.2,16.4),$scope.updateWeather=function(){}}]).filter("search3",function(){return function(data,text,people){text=text||"",text=text.toLowerCase();var out=[];if(text.length<3)return data;for(var i=0;i<people.length;i++){(people[i].hasOwnProperty("fio")?people[i].fio.toLowerCase():"").indexOf(text)>-1&&people[i].hasOwnProperty("table")&&out.indexOf(-1==data[people[i].table])&&(console.log(people[i]),out.push(data[people[i].table]))}return out}}),angular.module("main",[]).controller("mainCtrl",["$rootScope","$scope","$state","$timeout","db","unixDate","$cookies",function($rootScope,$scope,$state,$timeout,db,unixDate,$cookies){$scope.items=pageOptions.slice(2),$scope.$parent.header.hide=!0,$scope.CurrUserEmail=$rootScope.vars.contacts_email?$rootScope.vars.contacts_email.trim():"",$scope.unixTimeStamp=unixDate.getNowStamp(),$scope.animate=0!=localStorage.animate,$scope.welcome=!!localStorage.welcome,$scope.photo="1601bfe1-880a-4691-b4af-89793ccc7d07.jpg",$scope.continue=function(){$timeout(function(){$scope.welcome=!0,localStorage.welcome=1},500)},$scope.welcome||db.get("agreement").then(function(data){for(var v in data.values){$scope.agreement=data.values[v].text;break}}),$scope.animate||(localStorage.animate=1),$scope.goTo=function(page){$timeout(function(){$state.go(page)},500)};localStorage.my_id&&localStorage.my_id;$scope.name=localStorage.name?localStorage.name:"",$scope.getUnreadPushCnt=function(){var _push_count=localStorage.push_count?+localStorage.push_count:0;unixDate.getNowStamp();db.get("notices").then(function(resp){var push_count=0;for(var i in resp.values)resp.values[i].date_public<$scope.unixTimeStamp&&(-1!=resp.values[i].users.indexOf($scope.CurrUserEmail)||0==resp.values[i].users.length)&&(push_count+=1);$scope.push_count=push_count-_push_count,$scope.$$phase||$scope.$apply()})},$scope.getUnreadPushCnt();var _viewed_news=localStorage.viewed_news?JSON.parse(localStorage.viewed_news):[];db.get("module_notification",!$rootScope.vars.dev).then(function(data){var _news_count=0;for(var v in data.values)-1===_viewed_news.indexOf(v)&&data.values[v].hasOwnProperty("title")&&_news_count++;$scope.news_count=_news_count})}]),angular.module("news",[]).controller("newsCtrl",["$rootScope","$scope","$state","$timeout","db","unixDate","$mdDialog",function($rootScope,$scope,$state,$timeout,db,unixDate,$mdDialog){function DialogController($scope,$mdDialog){$scope.hide=function(){$mdDialog.hide()},$scope.cancel=function(){$mdDialog.cancel()},$scope.hStyle={color:"#fff"},$scope.changeClass=function(inp1,inp2){""!=inp1&&""!=inp2&&($scope.hStyle={color:"#fff"})},$scope.addPhoto=function(mode){},$scope.deletePhoto=function(item){$scope.fieldImg=null};var toHumanFormat=function(unixTimeStamp){var a=new Date(1e3*unixTimeStamp),months=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],month=(a.getFullYear(),months[a.getMonth()]);month<10&&(month="0"+month);var day=a.getDate(),hour=a.getHours();hour<10&&(hour="0"+hour);var min=a.getMinutes();min<10&&(min="0"+min);var sec=a.getSeconds();return sec<10&&(sec="0"+sec),day+" "+month+", "+hour+":"+min};$scope.answer=function(answer,fieldTitle,fieldBody,fieldImg){if($("#main").css({overflow:"auto"}),"send"==answer&&!fieldTitle)return void($scope.hStyle={color:"red"});if($mdDialog.hide(answer),"send"==answer){var d=new Date;d.setHours(d.getHours());var unix_time_stamp=Math.floor(d.getTime()/1e3),new_item={};new_item.date_public=unix_time_stamp,new_item.title=fieldTitle,new_item.desc=fieldBody,fieldImg&&(new_item.img=fieldImg),localStorage.name&&(new_item.author=localStorage.name),!$rootScope.vars.dev&&new_item.title&&""!=new_item.title&&db.add("module_notification",new_item),new_item.date_public_human=toHumanFormat(new_item.date_public),$rootScope.unixTimeStamp=Math.floor(d.getTime()/1e3),$rootScope.newsItems.push(new_item),$rootScope.scrollTop()}}}function createID(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(c){var r=16*Math.random()|0;return("x"===c?r:3&r|8).toString(16)})}$rootScope.unixTimeStamp=unixDate.getNowStamp(),$rootScope.filterOrg=!1,$scope.currentTime=unixDate.toHumanFormat(unixDate.getNowStamp()),$scope.mesCount={},$scope.webKey=localStorage.webKey,$scope.name=localStorage.name?localStorage.name:"";var _viewed_news=localStorage.viewed_news?JSON.parse(localStorage.viewed_news):[];$rootScope.showAdvanced=function(ev){$("#main").css({overflow:"hidden"}),$mdDialog.show({controller:DialogController,template:'<md-dialog class="add-news-feed-item-dialog" aria-label="Создать новость">                                    <form>                                        <md-toolbar>                                            <div class="md-toolbar-tools" style="background: #ed1d24;">                                                <h2>Post news</h2>                                            </div>                                        </md-toolbar>                                        <md-dialog-content class="md-dialog-content" style="max-width:800px;max-height:810px;">                                            <div style="color: red;font-size: 0.8em;line-height: 1.1em;margin-bottom: 5px;" ng-style="hStyle">Please fill the title field</div>                                            <input ng-change="changeClass(fieldTitle,fieldBody)" placeholder="Title" class="dialog-field new-news-title" id="fieldTitle" type="text" ng-model="fieldTitle">                                            <textarea ng-change="changeClass(fieldTitle,fieldBody)" placeholder="News content" class="dialog-field new-news-body" id="fieldBody" ng-model="fieldBody"></textarea>                                            <div class="photos" ng-show="fieldImg">                                                <div class="photo-block">                                                    <div>                                                        <a href="{{fieldImg | file}}" data-fancybox style="{{ fieldImg | file:\'cover\' }}"></a>                                                        <p ng-click="deletePhoto(fieldImg)"><img src="../img/delete.svg" alt=""></p>                                                    </div>                                                </div>                                            </div>                                            <div class="buttons">                                                <button class="photo_ photo_album" ng-disabled="fieldImg" ng-click="addPhoto(\'gallery\')"><img src="../img/photo-album.svg"> <span>Upload a photo</span></button>                                                <button class="photo_ photo_camera" ng-disabled="fieldImg" ng-click="addPhoto()"><img src="../img/photo-camera.svg"> <span>Make a photo</span></button>                                            </div>                                        </md-dialog-content>                                        <md-dialog-actions layout="row">                                            <span flex></span>                                            <md-button ng-click="answer(\'cancel\')" style="padding:0 5px; background:#e6e6e6">Cancel</md-button>                                            <md-button ng-click="answer(\'send\', fieldTitle, fieldBody,fieldImg)" style="padding:0 5px; background:#d8eae4">Post</md-dialog-actions>                                    </form>                                </md-dialog>',parent:angular.element(document.body),targetEvent:ev,clickOutsideToClose:!0,fullscreen:$scope.customFullscreen}).then(function(answer){"send"==answer||"cancel"==answer&&console.log("canceled")},function(){console.log("cancelled")})},$scope.checkLike=function(id){for(var flag=!1,name=localStorage.name?localStorage.name:"",i=0,len=$rootScope.newsItems.length;i<len;i++)if($rootScope.newsItems[i].guid===id){$rootScope.newsItems[i].like&&function(names){for(var i=0,len=names.length;i<len;i++)if(names[i]===name){flag=!0;break}}($rootScope.newsItems[i].like);break}return flag},$scope.like=function(id){var name=localStorage.name?localStorage.name:"",obj={};if(!1===$scope.checkLike(id)){for(var i=0,len_i=$rootScope.newsItems.length;i<len_i;i++)if($rootScope.newsItems[i].guid===id){$rootScope.newsItems[i].like||($rootScope.newsItems[i].like=[]),$rootScope.newsItems[i].like.push(name),obj[id]={like:"+"+name};break}}else for(var k=0,len_k=$rootScope.newsItems.length;k<len_k;k++)if($rootScope.newsItems[k].guid===id){var index=$rootScope.newsItems[k].like.indexOf(name);$rootScope.newsItems[k].like.splice(index,1),obj[id]={like:"-"+name};break}},$scope.deleteNews=function(id){console.log(id),{}[id]={status:"deleted"};for(var k=0,len_k=$rootScope.newsItems.length;k<len_k;k++)if($rootScope.newsItems[k].guid===id){$scope.$applyAsync(function(){$rootScope.newsItems.splice(k,1)});break}},$scope.showComments=function(id,index){$scope.curNewsItemId=id,$scope.curLocalNewsItemId=index,$scope.messages=[],$rootScope.showCommentsBlock=id;$scope.messageLimit=20},$scope.message={},$scope.sendMessage=function(){if(void 0!==$scope.message.id)for(var i=0,len=$scope.messages.length;i<len;i++)$scope.messages[i].id===$scope.message.id&&($scope.messages[i].text=$scope.message.text);else{var obj={},key=createID();obj[key]={author:localStorage.name?localStorage.name:"",date:(new Date).getTime(),text:$scope.message.text,id:key},$scope.messages=[obj[key]].concat($scope.messages)}db.edit("module_notification",{comcount:"math:+1"},$scope.curNewsItemId),$rootScope.newsItems[$scope.curLocalNewsItemId].comcount?$rootScope.newsItems[$scope.curLocalNewsItemId].comcount=+$rootScope.newsItems[$scope.curLocalNewsItemId].comcount+1:$rootScope.newsItems[$scope.curLocalNewsItemId].comcount=1,$scope.message={},delete $scope.cancelEdit},$rootScope.header.back=function(){void 0!==$rootScope.showCommentsBlock?delete $rootScope.showCommentsBlock:location.hash="#/main"},$scope.loadMoreMessages=function(){$scope.messages.length>$scope.messageLimit&&($scope.messageLimit+=20)},$rootScope.checkVisibility=function(orgMark){var result;return orgMark&&$rootScope.filterOrg?result=!0:!orgMark&&$rootScope.filterOrg?result=!1:orgMark&&!$rootScope.filterOrg?result=!0:orgMark||$rootScope.filterOrg||(result=!0),result},$scope.getNewsItems=function(){db.get("module_notification",!$rootScope.vars.dev).then(function(resp){$scope.loading=!0;var _data=[],obj={};for(var i in resp.values)obj={},obj=resp.values[i],obj.guid=i,obj.comcount?obj.comcount=+obj.comcount:obj.comcount=0,obj.date_public&&(obj.date_public_human=unixDate.toHumanFormat(obj.date_public)),obj.date_public&&(obj.date_public=+obj.date_public),_data.push(obj),-1===_viewed_news.indexOf(i)&&_viewed_news.push(i);$rootScope.newsItems=_data;for(var i=0,len=$rootScope.newsItems.length;i<len;i++)$rootScope.newsItems[i].ind=i;$scope.loading=!1,localStorage.viewed_news=JSON.stringify(_viewed_news)})},$scope.getNewsItems()}]).directive("scrollable",function(){return{restrict:"A",link:function(scope,element,attrs){var container=angular.element(element);container.bind("scroll",function(evt){container[0].offsetHeight+container[0].scrollTop+20>=container[0].scrollHeight&&scope.$apply(attrs.scrollable)})}}}),angular.module("notices",[]).controller("noticesCtrl",["$rootScope","$scope","db","unixDate","$cookies",function($rootScope,$scope,db,unixDate,$cookies){$scope.unixTimeStamp=unixDate.getNowStamp(),$scope.CurrUserEmail=$rootScope.vars.contacts_email?$rootScope.vars.contacts_email.trim():"",db.get("notices").then(function(resp){$scope.headers=resp.headers;var pushes=[],push={},id=0;for(var i in resp.values)push=resp.values[i],push.id=id,push.guid=i,push.date_public_human=unixDate.toHumanFormat(push.date_public),push.date_public=+push.date_public,pushes.push(push),push.date_public<$scope.unixTimeStamp&&(-1!=push.users.indexOf($scope.CurrUserEmail)||0==push.users.length)&&(id+=1);localStorage.push_count=id,$scope.alarms=pushes,console.log("$scope.alarms",$scope.alarms)})}]),angular.module("participants",[]).controller("participantsCtrl",["db","$rootScope","$scope","$state","$timeout","$mdDialog","Users","scroll","$http","$stateParams","$cookies",function(db,$rootScope,$scope,$state,$timeout,$mdDialog,Users,scroll,$http,$stateParams,$cookies){$scope.users=new Users,$rootScope.header.simpleSearch=!0,$rootScope.search&&($rootScope.search=""),$scope.gender=localStorage.gender?localStorage.gender:"",$rootScope.header.search_reset=function(){$rootScope.search="",$scope.users.step=$scope.users.save_step},$scope.my_id=localStorage.my_id?localStorage.my_id:"",$scope.mode=$stateParams.mode?$stateParams.mode:0,$scope.choosenId=$rootScope.neighbor1?$rootScope.neighbor1.split("/")[0]:"none","none"==$scope.choosenId&&($scope.choosenId=$rootScope.neighbor2?$rootScope.neighbor2.split("/")[0]:"none");var backToProfile=function(){$rootScope.header.back=function(){"captain"==$stateParams.mode?$state.go("profile",{tab:4}):$state.go("profile",{tab:3}),$rootScope.header.back=function(){location.hash="#/main"}}};$stateParams.mode&&backToProfile(),$scope.scroll=function(ScrollData){$timeout(function(){scroll.element=document.querySelector("main"),scroll.set(ScrollData,2),ScrollData=0},100)},$scope.openParticipant=function(id,name,lname){if($stateParams.mode&&0!=$stateParams.mode&&"captain"!=$stateParams.mode){var confirm=$mdDialog.confirm().title("Confirm your choice").textContent("Are you sure that you want to choose "+name+" "+lname+" as your preferred roommate (priority"+$stateParams.mode+")?").ok("Yes").cancel("No");$mdDialog.show(confirm).then(function(result){var field="neighbor"+$stateParams.mode,obj={};obj[field+""]=id+"/"+lname+" "+name,$rootScope["neighbor"+$stateParams.mode]=obj[field+""],$state.go("profile",{tab:3}),db.edit("participants",obj,$scope.my_id)})}else{var content=document.querySelector("main");content.scrollTop;$scope.loading=!0;var users=$scope.users.list;for(var i in users)if(users[i].id==id){$scope._participant=users[i];break}$timeout(function(){$scope.loading=!1},1e3),$rootScope.header.simpleSearch=!1,$rootScope.header.back=function(){$scope._participant=null,$rootScope.header.simpleSearch=!0,$timeout(function(){$("main").animate({scrollTop:$("#user-"+id).offset().top-110},500)},1e3),$rootScope.header.back=function(){location.hash="#/main"}},users=null}},$stateParams.id&&"none"!=$stateParams.id&&$scope.$watch("users.list",function(){$scope.users.list.length>0&&($scope.openParticipant($stateParams.id),backToProfile())})}]).factory("Users",["$http","$rootScope","$timeout",function($http,$rootScope,$timeout){var Users=function(){this.items=[],this.list=[],this.step=40,this.save_step=40,this.busy=!1};return Users.prototype.Init=function(){var link="../files/participants.json?unique="+(new Date).getTime();return $http.get(link)},Users.prototype.nextPage=function(){if(!this.busy){if(this.busy=!0,console.log(this.step),$rootScope.search)return this.step=this.list.length,void(this.busy=!1);if(this.step=this.save_step,this.items.length<1)this.Init().then(function(data){var _data=data.data.values,data_arr=(_data.length,[]);for(var v in _data){var obj=_data[v];obj.id=v,obj.order=_data[v].order?+_data[v].order:1e3,data_arr.push(obj)}this.list=data_arr,console.log("data_arr"),console.log(data_arr),this.items=data_arr.slice(0,40)}.bind(this));else{var _list=this.items.length+40;this.items=this.list.slice(0,_list),this.step+=20,this.save_step=this.step}40==this.step?$timeout(function(){this.busy=!1}.bind(this),1e3):this.busy=!1}},Users}]).filter("search2",function(){return function(data,text){text=text||"",text=text.toLowerCase();var out=[];if(text.length<3)return data;for(var i=0;i<data.length;i++){var fname=data[i].hasOwnProperty("name")?data[i].name.toLowerCase():"",lname=data[i].hasOwnProperty("lname")?data[i].lname.toLowerCase():"",flname=fname+" "+lname;(fname.indexOf(text)>-1||lname.indexOf(text)>-1||flname.indexOf(text)>-1)&&out.push(data[i])}return out}}),angular.module("premod",[]).controller("premodCtrl",["$scope","$rootScope","db","$timeout","$state","file","$mdDialog","communication","$stateParams","$http","$location",function($scope,$rootScope,db,$timeout,$state,file,$mdDialog,communication,$stateParams,$http,$location){$rootScope.header.moderation=!1;var timer;$scope.$on("$destroy",function(){$timeout.cancel(timer)});var my_id=!!localStorage.my_id&&localStorage.my_id;my_id&&db.get("participants",!$rootScope.vars.dev).then(function(participants){2==participants.values[my_id].status||3==participants.values[my_id].status?$rootScope.testmode="yes":$state.go("speakers")}),$scope.$parent.header.back=function(){$state.go("speakers")},$scope.showQuestions=!1,$scope.getTables=function(){db.get("speakers",!$rootScope.vars.dev).then(function(data){var speakers=[];for(var v in data.values)data.values[v].order=data.values[v].order?+data.values[v].order:1e3,speakers.push(data.values[v]);$scope.speakers=speakers,db.get("questions",!$rootScope.vars.dev).then(function(data2){for(var s in $scope.speakers){var questions_number=0,q_count=0;for(var v in data2.values)data2.values[v].speaker_email==$scope.speakers[s].email&&questions_number++,q_count++;var viewed=localStorage[$scope.speakers[s].email]?localStorage[$scope.speakers[s].email]:0;$scope.speakers[s].push_count=questions_number-+viewed}},function(resp){})}),timer=$timeout(function(){$scope.getTables()},7e3)},$scope.getTables(),$scope.openSpeaker=function(speaker){$scope.currentSpeaker=speaker,$scope.$parent.header.title=speaker.first_name+" "+speaker.last_name,db.get("questions",!$rootScope.vars.dev).then(function(data){$scope.loading=!0;var questions=[];for(var v in data.values)data.values[v].speaker_email==speaker.email&&(data.values[v].id=v,questions.push(data.values[v]));$scope.questions=questions,localStorage[speaker.email]=$scope.questions.length,$scope.loading=!1,$scope.showQuestions=!0}),$scope.$parent.header.back=function(){$scope.showQuestions?($scope.showQuestions=!1,$scope.$parent.header.title="Премодерация вопросов",$scope.getTables()):$state.go("speakers")}},$scope.premodToggle=function(question){1==question.moderation?question.moderation="0":question.moderation="1",db.edit("questions",question,question.id)}}]),angular.module("profile",["ngMask"]).controller("profileCtrl",["$rootScope","$scope","$state","$timeout","$cookies","file","db","$stateParams","$mdDialog",function($rootScope,$scope,$state,$timeout,$cookies,file,db,$stateParams,$mdDialog){$scope.tab=$stateParams.tab?$stateParams.tab:1,$scope.noInternet=!1,$scope.showBtnSaveStatus=!1,$scope.editStatus=!1;var my_id=localStorage.my_id?localStorage.my_id:"";my_id?db.get("participants",!$rootScope.vars.dev).then(function(participants){$scope.loading=!0;var participantsAll=participants.values,user=participants.values[my_id];for(var key in user)"transfers_to"!=key&&($rootScope[key]=user[key]);$rootScope.gender&&(localStorage.gender=$rootScope.gender),$scope.chosenDish=$rootScope.dish?+$rootScope.dish:"no",db.get("neighbors_status").then(function(data){for(var v in data.values){$scope.neighborStatus=data.values[v].status;break}if(2==$scope.neighborStatus&&$scope.neighbor_final[0]){var nf_id=$scope.neighbor_final[0];if(participantsAll[nf_id]){var nf=participantsAll[nf_id],nf_name=nf_id+"/"+nf.lname+" "+nf.name;$rootScope.neighbor_final=nf_name}}$scope.loading=!1})}):$scope.noInternet=!0,$scope.saveChangedStatus=function(mood){$rootScope.mood=mood,$scope.editStatus=!1,db.edit("participants",{mood:mood},my_id)},$scope.btnEditStatus=function(){$scope.editStatus=!0},$scope.chooseNeighbor=function(mode){$timeout(function(){$state.go("participants",{mode:mode,id:"none"})},500)},$scope.goToNeighbor=function(neighbor){var neighborId=neighbor.split("/")[0];neighbor&&$state.go("participants",{mode:0,id:neighborId})},$scope.noTravelTo=!1,$scope.noTravelFrom=!1,$scope.noTravelToMinsk=!1,$scope.noTravelFromMinsk=!1,$scope.getTravelData=function(to_or_from,noTravel,dynamic){db.get(to_or_from,dynamic).then(function(transfers){if(localStorage[to_or_from])$scope[to_or_from]=transfers.values[localStorage[to_or_from]];else{for(var v in transfers.values)if(transfers.values[v].participant.indexOf(my_id)>=0){$scope[to_or_from]=transfers.values[v],localStorage[to_or_from]=v;break}$scope[to_or_from]||($scope[noTravel]=!0,$scope[to_or_from]={})}},function(error){$scope.noTravelTo=!1,$scope.noTravelFrom=!1})},$scope.getTravelData("transfers_to","noTravelTo",!$rootScope.vars.dev),$scope.getTravelData("transfers_from","noTravelFrom",!$rootScope.vars.dev),$scope.getTravelData("transfers_tominsk","noTravelToMinsk",!1),$scope.getTravelData("transfers_fromminsk","noTravelFromMinsk",!1),$scope.toggleWay=function(way,transfer){$scope[transfer].way=way};var msgFillAllFields=function(){$mdDialog.show($mdDialog.alert().title("It is required that you fill all the fields").ok("Ок"))},addTravelDataToTable=function(obj,table){var confirm=$mdDialog.confirm().title("Please note that transfer data cannot be modified after submitting! Do you want to continue?").ok("Yes").cancel("No");$mdDialog.show(confirm).then(function(result){var data={};for(var key in obj)"way"!=key&&(data[key]=obj[key]);var participant=[];participant.push(my_id),data.participant=participant,data.user=localStorage.name?localStorage.name:"",data.user_email=$rootScope.vars.contacts_email?$rootScope.vars.contacts_email:"",db.add(table,data),$mdDialog.show($mdDialog.alert().title("The data has been sent successfully. Thank you!").ok("Ок")),"transfers_to"==table?$scope.noTravelTo=!1:$scope.noTravelFrom=!1})};$scope.sendTravelCard=function(transfer,table){transfer.way?"air"==transfer.way?transfer.date&&transfer.time&&transfer.airport&&transfer.flight?addTravelDataToTable(transfer,table):msgFillAllFields():transfer.date&&transfer.time&&transfer.station&&transfer.flight&&transfer.car?addTravelDataToTable(transfer,table):msgFillAllFields():msgFillAllFields()};var getCaptain=function(number){db.get("captains").then(function(captains){for(var v in captains.values)if(captains.values[v].number==number){$scope.captain=captains.values[v].captain,$scope.captainId=captains.values[v].captain_id;break}})};$scope.showTab=function(tab){$scope.tab=tab,4!=tab||$scope.captain||getCaptain($scope.command)},$scope.showTab($scope.tab),$scope.addPhoto=function(){file.attach()},$scope.removeAvatar=function(){$rootScope.photo=!1,$scope.$applyAsync(),db.edit("participants",{photo:""},my_id)},$scope.chooseDish=function(dish){0!=$rootScope.dish&&1!=$rootScope.dish&&($scope.chosenDish=dish)},$scope.sendDish=function(){$rootScope.dish=$scope.chosenDish,db.edit("participants",{dish:$scope.chosenDish},my_id),$mdDialog.show($mdDialog.alert().title("Thank you for your choice!").textContent("We will take it into account").ok("Ок"))}}]),angular.module("questions_to_orgs",[]).controller("questions_to_orgsCtrl",["$scope","$stateParams","$http","db","$rootScope","$state","$mdDialog","$filter","$timeout",function($scope,$stateParams,$http,db,$rootScope,$state,$mdDialog,$filter,$timeout){$scope.loading=!0,$scope.$parent.header.back=function(){$state.go("info",{section:"orgs"})},db.get("orgs").then(function(data){$stateParams.id&&data.values.hasOwnProperty($stateParams.id)&&($scope.speaker=data.values[$stateParams.id],$scope.loading=!1)}),$scope.sendForm=function(fquestion){var obj={};obj.question=fquestion,obj.date=$filter("date")(new Date,"yyyy-MM-dd HH:mm:ss"),$scope.speaker.lname&&$scope.speaker.name&&(obj.org=$scope.speaker.name+" "+$scope.speaker.lname),obj.author=localStorage.name?localStorage.name:"",obj.author_email=$rootScope.vars.contacts_email?$rootScope.vars.contacts_email:"",$scope.table_data=obj;obj.date,obj.author,obj.author_email,obj.question;$scope.question_text="",$timeout(function(){$mdDialog.show($mdDialog.alert().title("Thank you").textContent("Your question has been sent!").ok("ОК")),$scope.question=""},300)}}]),
angular.module("speakers",[]).controller("speakersCtrl",["$rootScope","$scope","$state","$timeout","db","$mdDialog","$stateParams",function($rootScope,$scope,$state,$timeout,db,$mdDialog,$stateParams){$rootScope.header.simpleSearch=!0,$rootScope.search&&($rootScope.search=""),$rootScope.header.moderation=!0;var my_id=!!localStorage.my_id&&localStorage.my_id;my_id&&db.get("participants",!$rootScope.vars.dev).then(function(participants){2!=participants.values[my_id].status&&3!=participants.values[my_id].status||($rootScope.testmode="yes")}),$rootScope.header.back=function(){$stateParams.id?"no"!=$stateParams.tab?$state.go("agenda",{tab:$stateParams.tab}):$state.go("news"):$scope.info?($scope.info=!1,$rootScope.header.simpleSearch=!0):(localStorage.animate=0,location.hash="#/main")},$scope.openSpeaker=function(speaker){$rootScope.header.simpleSearch=!1,$scope.info=speaker},$scope.info=!1,db.get("speakers",!$rootScope.vars.dev).then(function(data){var speakers=[];for(var v in data.values){var speaker={};speaker=data.values[v],speaker.order=data.values[v].order?+data.values[v].order:1e3,speakers.push(speaker)}$scope.speakers=speakers,$stateParams.id&&$scope.openSpeaker(data.values[$stateParams.id])}),$scope.sendQuestion=function(question){$timeout(function(){var date=new Date,unixDate=Math.floor(date.getTime()/1e3),data={};data.author=localStorage.name?localStorage.name:"",data.author_email=$rootScope.vars.contacts_email?$rootScope.vars.contacts_email:"",data.question=question,data.date=unixDate,data.speaker=$scope.info.last_name+" "+$scope.info.first_name,data.speaker_email=$scope.info.email,data.moderation=0,$rootScope.vars.dev||db.add("questions",data),$rootScope.question="",$mdDialog.show($mdDialog.alert().title("Thank you!").textContent("Your question has been sent to the speaker").ok("Ок"))},500)}}]).filter("speakers_search",function(){return function(data,text){text=text||"",text=text.toLowerCase();var out=[];if(text.length<3)return data;for(var i=0;i<data.length;i++){var fname=data[i].hasOwnProperty("first_name")?data[i].first_name.toLowerCase():"",lname=data[i].hasOwnProperty("last_name")?data[i].last_name.toLowerCase():"",flname=fname+" "+lname;(fname.indexOf(text)>-1||lname.indexOf(text)>-1||flname.indexOf(text)>-1)&&out.push(data[i])}return out}});var pageOptions=[{visible:!1,id:"main",title:"Начало",url:"/"},{visible:!0,id:"profile",title:"Profile",url:"/profile/:tab"},{visible:!0,id:"agenda",title:"Agenda",url:"/agenda/:tab"},{visible:!0,id:"speakers",title:"Speakers",url:"/speakers/:id&:tab"},{visible:!0,id:"participants",title:"Participants",url:"/participants/:mode&:id"},{visible:!0,id:"info",title:"Information",url:"/info/:section&:lname"},{visible:!0,id:"dinner",title:"Gala Dinner"},{visible:!0,id:"news",title:"News Feed"},{visible:!0,id:"notices",title:"Notifications"},{visible:!1,id:"premod",title:"Премодерация вопросов"},{visible:!1,id:"questions_to_orgs",title:"Questions to organizers",url:"/questions_to_orgs/:id"}];angular.module("app",["ui.router","infinite-scroll","ngSanitize","ngAnimate","ngCookies","app.config","app.directives","app.filters","app.factories","app.services","ngMaterial","ngTouch","ui.bootstrap","app.controllers"].concat(pageOptions.map(function(e){return e.id}))).run(["$rootScope","variables","Drawer",function($rootScope,variables,Drawer){variables.update("event_*,device_*,personal_*,contacts_*,chats_list,messages_list_*,chat_messages_*"),$rootScope.navDrawer=new Drawer(nav)}]),angular.module("app.config",[]).constant("defaultVariables",{event_guid:"vdp3ceuz",device_guid:"3p888y4d",contacts_email:"qwerty",personal_first_name:"Svetlana",personal_last_name:"Rozhkova",personal_team:"agenda2",dev:!0}).constant("$",window.jQuery).config(function($httpProvider){$httpProvider.defaults.headers.common={"Content-Type":"application/x-www-form-urlencoded"},$httpProvider.defaults.headers.get={"Content-Type":"application/x-www-form-urlencoded"},$httpProvider.defaults.headers.post={"Content-Type":"application/x-www-form-urlencoded"}}).config(["$stateProvider","$urlRouterProvider","$qProvider",function($stateProvider,$urlRouterProvider,$qProvider){$urlRouterProvider.otherwise("/"),$qProvider.errorOnUnhandledRejections(!1);for(var i=0;i<pageOptions.length;i++)$stateProvider.state(pageOptions[i].id,{url:pageOptions[i].url||"/"+pageOptions[i].id,views:{viewTopMenu:{controller:"headerCtrl"},viewBody:{templateUrl:pageOptions[i].id+"/"+pageOptions[i].id+".html",controller:pageOptions[i].id+"Ctrl"}}})}]),angular.module("app.controllers",[]).controller("globalCtrl",["$rootScope","scroll","$timeout","$scope",function($rootScope,scroll,$timeout,$scope){$rootScope.scrollTop=function(){scroll.element=document.querySelector("main"),scroll.animateTo("top",0)},$scope.animateTimeout=function(callback){callback&&$timeout(function(){callback()}.bind(this),100)};var now=new Date;$rootScope.expireDate=new Date(now.getFullYear()+1,now.getMonth(),now.getDate()).toGMTString(),$rootScope.$on("$stateChangeSuccess",function(event,toState,toParams,fromState,fromParams){if(""!==fromState.name){var data={},params=[];for(var p in fromParams)params.push(fromParams[p]);var s=params.length?params.join("&"):"";data.url="?/#!/"+fromState.name+"/"+s,toState.name}}),$scope.firstTime=!1,$scope.showFancy=function(data){var pictures=angular.element(data.currentTarget).parents(".docs-pictures")[0];angular.element("body").addClass("overhidden");var viewer,options={url:"data-original",ready:function(e){$scope.firstTime?(viewer.destroy(),$scope.firstTime=!1,angular.element(angular.element(data.currentTarget)).trigger("click")):$scope.firstTime=!0},show:function(e){},shown:function(e){},hide:function(e){angular.element("body").removeClass("overhidden")},hidden:function(e){},view:function(e){},viewed:function(e){}};viewer=new Viewer(pictures,options)}}]).controller("menuCtrl",["$rootScope","$scope","$timeout","$state",function($rootScope,$scope,$timeout,$state){$scope.items=pageOptions,$scope.goToPage=function(page){$state.go(page)},$scope.close=function(){$timeout(function(){$rootScope.navDrawer.close()},500)}}]).controller("headerCtrl",["$rootScope","$scope","$timeout","$state",function($rootScope,$scope,$timeout,$state){var page=pageOptions.filter(function(n){return n.id==$state.current.name})[0];$rootScope.header={title:page?page.title:""},$rootScope.header.back=function(){localStorage.animate=0,location.hash="#/main"},$rootScope.noAnimation=!0}]),angular.module("app.directives",[]).directive("scrolltop",function($window){return function(scope,element,attrs){angular.element(document.querySelector("main")).bind("scroll",function(){scope.scrolled=this.scrollTop>=.1*window.innerHeight,scope.$apply()})}}).directive("hello",["$timeout",function($timeout){return{restrict:"A",link:function(scope,element,attr){$(element).addClass("active")}}}]).directive("onLongPress",function($timeout){return{restrict:"A",link:function($scope,$elm,$attrs){$elm.bind("touchstart",function(evt){$scope.longPress=!0,$timeout(function(){$scope.longPress&&$scope.$apply(function(){$scope.$eval($attrs.onLongPress)})},1e3)}),$elm.bind("touchend",function(evt){$scope.longPress=!1,$attrs.onTouchEnd&&$scope.$apply(function(){$scope.$eval($attrs.onTouchEnd)})})}}}).directive("loading",function(){return{restrict:"E",replace:!0,template:'<div class="loading"><div><svg width="108px" height="108px" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" preserveAspectRatio="xMidYMid" class="uil-clock"><rect x="0" y="0" width="100" height="100" fill="none" class="bk"></rect><circle cx="50" cy="50" r="30" fill="#fff" stroke="#ed1d24" stroke-width="8px"></circle><line x1="50" y1="50" x2="50" y2="30" stroke="#3c302e" stroke-width="5" stroke-linecap="round"><animateTransform attributeName="transform" type="rotate" from="0 50 50" to="360 50 50" dur="1s" repeatCount="indefinite"></animateTransform></line><line x1="50" y1="50" x2="50" y2="20" stroke="#fefefe" stroke-width="2px" stroke-linecap="round" opacity="0"><animateTransform attributeName="transform" type="rotate" from="0 50 50" to="360 50 50" dur="0.2s" repeatCount="indefinite"></animateTransform></line></svg><h1>LOADING...</h1></div></div>',link:function(scope,element,attr){scope.$watch("loading",function(val){val?$(element).show():$(element).hide()})}}}).directive("epButton",["$timeout","$state",function($timeout,$state){return function(scope,element,attrs){var delayMs=attrs.delayMs?attrs.delayMs:400,durationMs=attrs.durationMs?attrs.durationMs:800,buttonElem=angular.element("<md-button class='ep-button md-button md-raised button_"+attrs.order+"'>"+attrs.content+"</md-button>"),styleElem=angular.element("<style>."+attrs.effectName+"{animation-duration: "+durationMs+"ms !important; -webkit-animation-duration: "+durationMs+"ms !important;</style>");element.append(buttonElem),element.append(styleElem),buttonElem.bind("click",function(){buttonElem.addClass(attrs.effectName);var self=buttonElem;$timeout(function(){self.removeClass(attrs.effectName),$state.go(attrs.link)},delayMs),$timeout(function(){attrs.callbackName&&scope.$eval(attrs.callbackName)},1.2*delayMs)})}}]);var app=angular.module("app.factories",[]).factory("scroll",["$rootScope",function($rootScope){return{bezier:new Bezier(.25,.1,.25,1),element:"main",get:function(){return this.element.scrollTop},set:function(value){this.element.scrollTop=value},animate:function(){if(this.get()!==this.last&&!1!==this.last)return!1;this.n+=1/this.time/60,this.set(this.start+this.bezier.get(this.n)*(this.to+1e3)),this.last=this.get(),this.n<1?requestAnimationFrame(this.animate.bind(this)):this.callback&&this.callback()},animateTo:function(to,time,callback){if(this.to=to||0,"string"==typeof this.to&&(this.to={top:0,bottom:this.element.scrollHeight-window.innerHeight,center:(this.element.scrollHeight-window.innerHeight)/2}[this.to]),0===time)return this.set(this.to),!1;this.time=time||1,this.n=0,this.callback=callback,this.start=this.get(),this.last=!1,this.to=Math.min(this.to,this.element.scrollHeight-window.innerHeight),this.to-=this.start,setTimeout(this.animate.bind(this),0)}}}]).factory("Drawer",["$timeout",function($timeout){var Drawer=function(element,width){this.domElement=element,this.width=width||element.clientWidth-20,this.content=this.domElement.getElementsByClassName("content")[0],this.shadow=this.domElement.getElementsByClassName("shadow")[0],this.drag=!1,this.offset=0,this.domElement.addEventListener("mousedown",this.pointerdown.bind(this)),this.domElement.addEventListener("touchstart",this.pointerdown.bind(this)),this.shadow.addEventListener("click",this.close.bind(this)),this.previousEvents=!1,this.alpha=!1};return Drawer.prototype.set=function(value){value&&(this.offset=value),this.shadow.style.display=this.offset>0?"block":"none",this.shadow.style.opacity=this.offset/this.width,this.domElement.style.left=-this.width+this.offset+"px"},Drawer.prototype.toch2mouse=function(event){event.touches&&event.touches.length&&(event.clientX=event.touches[0].clientX,event.clientY=event.touches[0].clientY)},Drawer.prototype.setEvents=function(value){var action=(value?"add":"remove")+"EventListener";document[action]("mousemove",this.pointermove.bind(this)),document[action]("mouseup",this.pointerup.bind(this)),document[action]("touchmove",this.pointermove.bind(this)),document[action]("touchend",this.pointerup.bind(this))},Drawer.prototype.pointerdown=function(event){this.toch2mouse(event),this.drag=this.offset-event.clientX,this.domElement.classList.add("move"),this.setEvents(!0)},Drawer.prototype.pointermove=function(event){this.toch2mouse(event),!1!==this.drag&&(this.set(Math.min(this.drag+event.clientX,this.width)),event.preventDefault(),this.previousEvents&&event.clientX!=this.previousEvents.clientX&&(this.alpha=event.clientX-this.previousEvents.clientX),this.previousEvents=event)},Drawer.prototype.pointerup=function(event){this.toch2mouse(event),this.drag=!1,this.domElement.classList.remove("move"),this.setEvents(!1),this.offset=this.offset>this.width/2?this.width:0,this.set()},Drawer.prototype.toggle=function(event){$timeout(function(){this.set(this.offset?0:this.width)}.bind(this),500)},Drawer.prototype.open=function(event){this.set(this.width)},Drawer.prototype.close=function(event){this.set(this.offset=0)},Drawer.prototype.resize=function(){main.style.height=window.innerHeight-header.clientHeight+"px"},Drawer}]);angular.module("app.filters",[]).filter("cutPhone",function($rootScope){return function(phone){if(phone){var width=document.documentElement.clientWidth;return"ios"==$rootScope.vars.device_platform&&width>760?phone=phone.replace(/\/\?epadvisorIgnoreRequest=true/g,""):"android"==$rootScope.vars.device_platform&&(phone=phone.replace(/\/\?epadvisorIgnoreRequest=true/g,"")),phone}}}).filter("timeAgo",function(){return function(date,lang){var time=(new Date).getTime()-1e3*date,date=new Date(time-6216723e7),words={s:["секунду","секунды","секунд","секунду","getSeconds"],m:["минуту","минуты","минут","минуту","getMinutes"],h:["час","часa","часов","час","getHours"],d:["день","дня","дней","дней","getDate"],w:["неделю","недель","недель","неделю",""],M:["месяц","месяца","месяцов","месяц","getMonths"],y:["год","года","лет","год","getYear"],c:["век","века","веков","век",""]},getNumber=function(value){var char=value.toString().slice(-1);return char>=5||0==char?2:char>=2?1:1==char?0:void 0},getСollocation=function(word,number){return number+" "+words[word][getNumber(number)]},getFormat=function(value){return getСollocation(value,date[words[value][4]]())},getDate=function(str){for(var arr=[],i=0;i<str.length;i++)arr.push(getFormat(str[i]));return arr.join(", ")+" назад"};return time<1e4?"только что":getDate(time<6e4?"s":time<36e5?"m":time<864e5?"h":time<26784e5?"d":time<31536e6?"Md":"y")}}).filter("file",function(){return function(file,type){if(!file)return!1;var storages={ondemand:"../files/",static:"../static/",files:"../files/"},url="";switch(url="ondemand"==file.split("/")[0]?storages.ondemand+file.split("/")[1]:"static"==file.split("/")[0]?storages.static+file.split("/")[1]:"files"==file.split("/")[0]?storages.files+file.split("/")[1]:storages.ondemand+file,type){case"bg":return"background-image: url("+url+");";case"cover":return"background: url("+url+") center no-repeat; background-size: cover;";case"contain":return"background: url("+url+") center no-repeat; background-size: contain;";default:return url}}}).filter("html",["$sce",function($sce){return function(htmlCode,limit){return $sce.trustAsHtml(htmlCode.split(/[\s]+/).slice(0,limit).join(" ")+(htmlCode.length>limit?"…":""))}}]).filter("search",function(){return function(data,text){text=text||"",text=text.toLowerCase();var out=[];if(text.length<3)return data;for(var i=0;i<data.length;i++){var fname=data[i].hasOwnProperty("personal_first_name")?data[i].personal_first_name.toLowerCase():"",lname=data[i].hasOwnProperty("personal_last_name")?data[i].personal_last_name.toLowerCase():"",flname=fname+" "+lname;(fname.indexOf(text)>-1||lname.indexOf(text)>-1||flname.indexOf(text)>-1)&&out.push(data[i])}return out}}).filter("simpleSearch",function(){return function(input,search){if(!input)return input;if(!search)return input;var expected=(""+search).toLowerCase(),result={};return angular.forEach(input,function(value,key){-1!==(""+value.name).toLowerCase().indexOf(expected)&&(result[key]=value)}),result}}),function(){if(/ipad|iphone/gi.test(window.navigator.userAgent)){document.querySelector("header").classList.add("ios");document.querySelector("nav").classList.add("ios");document.querySelector("main").classList.add("ios");document.querySelector("newsFeedBlock").classList.add("ios")}else setInterval(function(){for(var e=document.querySelectorAll("main, md-tabs:not(.md-no-tab-content):not(.md-dynamic-height)"),i=0;i<e.length;i++)e[i].style.height=window.innerHeight-56+"px"},100)}();var app=angular.module("app.services",[]).service("feedback",["$http",function($http){this.get=function(reference,folder){},this.send=function(title,reference,obj){}}]).service("pushModal",["$rootScope","$mdToast","$state",function($rootScope,$mdToast,$state){var that=this;this.show=function(action,message){$mdToast.show({controller:function($scope){$scope.closer=function(){that.close()},$scope.goPushes=function(){}},controllerAs:"pushCtrl",hideDelay:3e6,position:"top",template:'      <md-toast id="toastOverlay" ng-click="closer()">                           <div class="content-thoats" flex>                             <div class="message">'+message+'</div>                             <div class="buttons" ng-if="'+action+'">                               <md-button md-no-ink class="button md-primary go_pushes_button"   ng-click="goPushes()">Перейти</md-button>                               <md-button md-no-ink class="button md-primary cancel_push_button" id="toastCloseBtn" ng-click="closer()">Закрыть</md-button>                             </div>                           </div>                           <md-button md-no-ink class="md-primary close_button" ng-click="closer()"></md-button>                         </md-toast>'})},this.close=function(){$mdToast.hide()}}]).service("db",["$http",function($http){this.get=function(reference,dynamic){return $http.get("../files/"+reference+".json?unique="+(new Date).getTime()).then(function(response){return response.data},function(){console.log("Не найден "+reference+".json")})},this.add=function(reference,data){},this.edit=function(reference,data,rowid){}}]).service("variables",["$rootScope","defaultVariables","$http","$mdDialog",function($rootScope,defaultVariables,$http,$mdDialog){this.update=function(params){$rootScope.vars=defaultVariables}}]).service("file",["$mdDialog",function($mdDialog){this.attach=function(size,quality,memtype){var confirm=$mdDialog.confirm({clickOutsideToClose:!0,template:['<md-dialog md-theme="{{ dialog.theme }}" aria-label="{{ dialog.ariaLabel }}" ng-class="dialog.css">','  <md-dialog-content class="md-dialog-content" role="document" tabIndex="-1">','    <h2 class="md-title">Please select the source for a photo that you want to insert</h2>',"  </md-dialog-content>","  <md-dialog-actions>",'    <md-button ng-click="answer(\'gallery\')" class="md-primary">Gallery</md-button>','    <md-button ng-click="answer(\'photo\')" class="md-primary">Camera</md-button>',"  </md-dialog-actions>","</md-dialog>"].join("").replace(/\s\s+/g,""),controller:function($scope,$mdDialog){$scope.answer=function(type){$mdDialog.hide()}}});$mdDialog.show(confirm)}}]).service("unixDate",[function(){this.getNowStamp=function(){var d=new Date;return d.setHours(d.getHours()),unixTimeStamp=Math.floor(d.getTime()/1e3)},this.toHumanFormat=function(unixTimeStamp){var a=new Date(1e3*unixTimeStamp),months=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],month=(a.getFullYear(),months[a.getMonth()]);month<10&&(month="0"+month);var day=a.getDate(),hour=a.getHours();hour<10&&(hour="0"+hour);var min=a.getMinutes();min<10&&(min="0"+min);var sec=a.getSeconds();return sec<10&&(sec="0"+sec),day+" "+month+", "+hour+":"+min}}]);
//# sourceMappingURL=main.js.map
